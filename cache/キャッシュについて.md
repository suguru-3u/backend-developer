# 概要
このページは、サーバーサイド、フロントエンドのキャッシュについて内容を整理するために記載しているページです。
情報の過不足があると思いますが、温かい目で見守っていただけると幸いです。

# キャッシュの種類について
## サーバーサイド
### キャッシュの対象について
サーバーサイドでキャッシュすべきものは、以下のものが挙げられる。

- ユーザーのアクセス・リフレッシュトークン
- DBから取得する重たいデータ（頻繁にデータ更新されないもの）
- データ分析・統計系の集計結果（定期更新でよい場合）
- 外部サービス・サーバーから情報を取得するもの（頻繁にデータ更新されないもの）
    - 天気情報、為替レート、ニュースヘッドラインなど
    　※更新頻度や許容される遅延に応じてTTL（Time-To-Live）を設定

### 使用される技術
|種類|ツール|用途|
| ---- | ---- | ---- |
|メモリキャッシュ|Caffeine, Guava, Ehcache|	アプリ内での超高速なアクセス|
|分散キャッシュ|Redis, Memcached	|複数サーバーで共有、トークンや権限キャッシュなど|
|HTTPキャッシュ| CDN, Nginxのキャッシュ|	静的HTMLやAPIレスポンスのキャッシュ
|DB内キャッシュ|Materialized Viewなど|	RDBで重たいクエリ結果を保存|

#### <メモリキャッシュ>
メモリキャッシュは、アプリが実行中にデータを一時的にRAM（メモリ）に保存する方法。
メモリに保存されるため、データへのアクセス速度が非常に速い。

**デメリット**
- 小容量であるため、過剰なメモリ使用はシステムからアプリが強制終了される原因になる。

**特徴**
- アプリが終了したり、システムのメモリが不足した場合、キャッシュデータは消失する。

**使用されるケース**
- 重いDBアクセスの結果を一時保存
- 計算コストの高い処理結果を使い回す
- 外部APIなどのレスポンスを一時保存

**使用方法**
- プログラムで変数を作成してそこに保存する方法やSpringフレームワーク、Caffeine、Ehcacheをツールを使用してキャッシュを行う

**注意点**
-  キャッシュしすぎるとメモリ圧迫や古いデータ問題が出る、TTL（Time To Live）やサイズ上限は適切に設定すべきで本番環境では分散キャッシュ（Redisなど）との併用も一般的みたいです。

#### ︎︎ <︎分散キャッシュ>
- 分散キャッシュは、複数サーバーでキャッシュの内容を共有したり、トークンや権限キャッシュなどで使用される。

**メリット**
- 外部サーバーのインメモリに保存されるため、データへのアクセス速度が非常に速い。
- キーバリューのNoSQLで、簡単にデータを取得することができる。

**デメリット**
- キーバリュー型のNoSQLのため、複雑な検索をすることができない。

**特徴**
- キーバリュー型のNoSQL

**使用されるケース**
- マイクロサービスなどで、複数のサービス間でキャッシュ内容を共有する時
- ユーザーの認証情報の保存
- セッション管理（ステートレスAPIでもログイントークン状態を記録）
- レートリミット管理（ユーザー単位のアクセス頻度制御）
- 分散ロック（複数ノード間の排他制御）

**使用方法**
- Redisなどのツールを利用して、キャッシュ情報を保存する

**注意点**
- 適切なTTLの設定、最大容量制限やEviction（削除ポリシー）を確認しておく必要がある

#### ︎<HTTPキャッシュ>
- HTTPキャッシュは、HTMLの静的ページ・画像やAPIのレスポンス内容をキャッシュする際に使用されます。
- HTTPキャッシュはどこに保存するかで、主に2種類に分けられます
    - ブラウザキャッシュ（クライアント側）
    - CDN／ミドルウェア（中間・サーバー側）

**メリット**
- クライアントはサーバからのレスポンスが高速に返ってくるため、ユーザー体験の向上につながる

**デメリット**
- 設定が適切でないと古いデータが表示される
- キャッシュ破棄・更新の設計が難しい
- 機密情報のキャッシュはセキュリティリスク

**特徴**
- HTTPヘッダーで制御できる（Cache-Control, ETag, Expiresなど）
- ブラウザ・CDN・プロキシなど複数レイヤーでのキャッシュに対応
- 明示的な無効化や再検証も可能

**使用されるケース**
- 世界各地からアクセスされるサービスの場合、CDNを使用して静的ページを高速でレスポンスする
- 処理が重いAPIのレスポンス内容をキャッシュする
- アプリ側でHTTPヘッダーを返すことで直接制御することもできます。
- JavaScriptのfetch()でもcacheオプションを指定可能。

**使用方法**
- CDN（Cloudflare, Akamai, CloudFrontなど）
- Nginx / Apache のキャッシュ機能
- アプリでCache-ControlやETagを返す設定

**注意点**
- キャッシュの有効期限（TTL）を適切に設定する必要がある
- 機密情報（ログイン状態や個人情報）はキャッシュしない
- CDNやブラウザに残るキャッシュの「削除・更新」が難しいことがある（バージョン付きURLなどで対処）

#### DB内キャッシュ
設定を行うことで、ディスクへのアクセスしないようにメモリにデータをキャッシュすることが可能らしい
もちろんチューニングも可能
